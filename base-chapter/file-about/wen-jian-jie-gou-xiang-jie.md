# 文件简介
linux下一切皆文件，包括内存，磁盘，网络都可以用文件的形式表示。操作系统的主要功能之一就是文件管理，所以文件是一种非常重要的资源。目录是一种特殊的文件，他的存储文件的名称和相关信息。


# 文件组成
文件主要由两部分组成，一是文件的元信息，由inode表示，二是文件的数据，由block表示


# inode
用于存储文件的各属性，包括

|元数据 |说明 |
|--- |--- |
|所有者信息 | owner, group, other |
|权限信息 | read, write, execute |
|时间信息 | 修改时间（mtime）,访问时间（atime）,状态时间（ctime）|
|标志信息 | 文件的一些flag |
|链接数 | 有多少文件名指向这个inode |
|内容信息 |type, size和对应的block的位置信息 |

> - inode也会消耗硬盘空间，所以硬盘格式化的时候，操作系统自动将硬盘分成两个区域。  
- 一个是数据区，存放文件数据，另一个是inode区（inode table），存放 文件元信息。  
- 每个inode节点的大小，一般是128字节或256字节。
- inode节点的总数，在格式化时就给定，一般是每1KB或每2KB就设置一个inode。  
- 假定在一块1GB的硬盘中，每个inode节点的大小为128字节，每1KB就设置一个inode，那么inode table的大小就会达到128MB，占整块硬盘的12.8%


# block
用来存储文件的内容数据

# 软链接和硬链接
## 软链接
> 
- 软链接（也叫符号链接）是指向另一个文件的特殊文件，这种文件的数据部分仅包含它所要链接文件的路径名。  
- 软链接是为了克服硬链接的不足而引入的，软链接不直接使用inode号作为文件指针，而是使用文件路径名作为指针（软链接：文件名+数据部分‐‐>目标文件的路径名）。
- 软链接有自己的inode，并在磁盘上有一小片空间存放路径名。因此，软链接能够跨文件系统，也可以和目录链接。
- 软链接可以对一个不存在的文件名进行链接，但直到这个名字对应的文件被创建后，才能打开其链接。
- 当软链接指向的文件删除重命名或移动后，软链接并不会发生更新。


## 硬链接
> - 硬链接是通过索引节点进行的链接。 
- 该登记项具有一个新的文件名和要连接文件的inode 号，文件的目录登记项就是源文件的硬链接（硬链接，目录登记项： 文件名‐‐>文件的inode；文件名可以有多个，但文件inode 只是一个）。
- 不论一个文件有多少硬链接，在磁盘上只有一个描述它的inode，只要该文件的链接数不为0，该文件就保持存在。硬链接不能跨越文件系统，为避免无限递归，一般也不能在目录上建立hard link。 
- 硬连接是直接建立在节点表上的（inode），建立硬连接指向一个文件的时候，会更新节点表上面的计数值。举个例子，一个文件被连接了两次（硬连接），这个文件的计数值是3，而无论通过3个文件名中的任何一个访问，效果都是完全一样的，但是如果删除其中任意一个，都只是把计数值减1，不会删除实际的内容的，（任何存在的 文件本身就算是一个硬连接）只有计数值变成0也就是没有任何硬连接指向的时候才会真实的删除内容。
- 对任何一个硬链接文件修改，都会对原文件进行修改。

# lsof


<br/>

---
# 参考

[Linux文件系统的最基本数据结构：inode和block][1]
[理解inode][2]

[1]: http://zhang789.blog.51cto.com/11045979/1846339
[2]: http://www.ruanyifeng.com/blog/2011/12/inode.html