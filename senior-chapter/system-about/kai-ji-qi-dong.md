# 启动过程
从打开电源到开始操作，计算机的启动是一个非常复杂的过程

- 第一阶段：BIOS
- 第二阶段：主引导记录
- 第三阶段：硬盘启动
- 第四阶段：操作系统

## BIOS
- 上个世纪70年代初，"只读内存"（read-only memory，缩写为ROM）发明
- 开机程序被刷入ROM芯片，计算机通电后，第一件事就是读取它
- 这块芯片里的程序叫做"基本输入输出系统"，简称为BIOS

> 基本输入输出系统（Basic Input/Output System）

### 硬件自检
BIOS程序首先检查，计算机硬件能否满足运行的基本条件，这叫做"硬件自检"（Power-On Self-Test），缩写为POST

### 启动顺序
硬件自检完成后，BIOS把控制权转交给下一阶段的启动程序，BIOS需要有一个外部储存设备的排序，排在前面的设备就是优先转交控制权的设备，这种排序叫做"启动顺序"（Boot Sequence）


## 主引导记录
启动程序会读取启动设备的第一个扇区，也就是读取最前面的512个字节，这最前面的512个字节，就叫做"主引导记录"（Master boot record，缩写为MBR）

### 主引导记录的结构

1. 第1-446字节：调用操作系统的机器码
2. 第447-510字节：分区表（Partition table）
3. 第511-512字节：主引导记录签名（0x55和0xAA）

### 分区表
考虑到每个区可以安装不同的操作系统，"主引导记录"因此必须知道将控制权转交给哪个区
> 分区表的长度只有64个字节，每个主分区的16个字节，所以只能有4个主分区

1. 第1个字节：如果为0x80，就表示该主分区是激活分区，控制权要转交给这个分区。四个主分区里面只能有一个是激活的。
2. 第2-4个字节：主分区第一个扇区的物理位置（柱面、磁头、扇区号等等）。
3. 第5个字节：主分区类型。
4. 第6-8个字节：主分区最后一个扇区的物理位置。
5. 第9-12字节：该主分区第一个扇区的逻辑地址。
6. 第13-16字节：主分区的扇区总数。


## 硬盘启动
这时，计算机的控制权就要转交给硬盘的某个分区了，这里又分成三种情况

### 卷引导记录
四个主分区里面，只有一个是激活的。计算机会读取激活分区的第一个扇区，叫做"卷引导记录"（Volume boot record，缩写为VBR）

### 扩展分区和逻辑分区
随着硬盘越来越大，四个主分区已经不够了，需要更多的分区。
- 但是，分区表只有四项，因此规定有且仅有一个区可以被定义成"扩展分区"（Extended partition）
- 所谓"扩展分区"，就是指这个区里面又分成多个区。这种分区里面的分区，就叫做"逻辑分区"（Logical partition）
- 计算机先读取扩展分区的第一个扇区，叫做"扩展引导记录"（Extended boot record，缩写为EBR）


### 启动管理器
在这种情况下，计算机读取"主引导记录"前面446字节的机器码之后，不再把控制权转交给某一个分区，而是运行事先安装的"启动管理器"（boot loader），由用户选择启动哪一个操作系统



# 操作系统
控制权转交给操作系统后，操作系统的内核首先被载入内存，然后是一系列初始化工作
> 操作系统的初始化流程参考[Linux的启动流程][2]


<br/>

---

# 参考

[计算机是如何启动的][1]  
[Linux的启动流程][2]  
[Linux守护进程详解(init.d和xinetd)][3]  
[Linux学习之/etc/init.d/functions详解][4]  
[linux下的initlog][5]    
[linux开机脚本示例][6]  

[1]: http://www.ruanyifeng.com/blog/2013/02/booting.html
[2]: http://www.ruanyifeng.com/blog/2013/08/linux_boot_process.html
[3]: http://www.cnblogs.com/wuchanming/p/4038552.html
[4]: http://www.cnblogs.com/sunfie/p/5149678.html
[5]: http://www.haw-haw.org/post/72
[6]: https://github.com/Supervisor/initscripts